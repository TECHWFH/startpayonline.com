<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>рдкреНрд▓реЙрдЯ рдХреНрд╖реЗрддреНрд░рдлрд▓ рдФрд░ рд▓рд╛рдЧрдд рдХреИрд▓рдХреБрд▓реЗрдЯрд░ тАФ рдбрд╛рдпрдЧреНрд░рд╛рдо рд╕рд╣рд┐рдд</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body { font-family: Arial, sans-serif; background: #f0f4f8; margin:0; padding:16px; }
  table { width:100%; border-collapse:collapse; margin-top:10px; }
  th, td { border:1px solid #ccc; padding:6px; text-align:left; font-size:13px; }
  th { background:#ffcdd2; }
  .total-row { background:#ddd; font-weight:bold; }
  .final-total-row { background: linear-gradient(to right, #1e3a8a, #dc2626); color:white; font-weight:bold; }
  .remove-btn { color:red; cursor:pointer; font-weight:bold; }
  .canvas-wrap { background:white; border:1px solid #eee; padding:8px; border-radius:6px; text-align:center; }
  .legend { display:flex; gap:8px; flex-wrap:wrap; justify-content:center; margin-top:6px; font-size:13px; }
  .legend-item { display:flex; gap:6px; align-items:center; }
  .dot { width:18px; height:10px; display:inline-block; border-radius:3px; }
  /* Responsive tweaks */
  @media (max-width: 768px) {
    body { padding:10px; }
    .no-print { font-size:13px; }
    th, td { font-size:12px; padding:5px; }
    .dot { width:14px; height:8px; }
  }
</style>
</head>
<body>

<!-- Top Header -->
<div class="no-print text-center font-bold text-[#FF0000] p-2 bg-white rounded-lg mx-auto mb-3 max-w-full">
    by Anurag Rai | тШО 9340726600 | ЁЯЫа Technical Support Consultant
</div>

<!-- Print Button -->
<div class="no-print text-center mb-3">
    <button id="printBtn" class="bg-indigo-600 text-white px-4 py-2 rounded shadow">ЁЯЦия╕П Print / Export PDF</button>
</div>

<h1 class="text-xl font-bold text-center mb-3">ЁЯПЧя╕П рдкреНрд▓реЙрдЯ рдХреНрд╖реЗрддреНрд░рдлрд▓ рдФрд░ рд▓рд╛рдЧрдд рдХреИрд▓рдХреБрд▓реЗрдЯрд░</h1>

<div class="grid grid-cols-1 lg:grid-cols-3 gap-4">

  <!-- Inputs -->
  <div class="bg-white p-3 rounded shadow">
    <h2 class="font-bold mb-2">рдЗрдирдкреБрдЯ рдкреИрд░рд╛рдореАрдЯрд░реНрд╕</h2>

    <label class="block text-sm">рдкреНрд░рддрд┐ рд╡рд░реНрдЧ рдлреБрдЯ рджрд░ (рдкреВрд░реА)</label>
    <input type="number" id="rateFull" value="300" class="border p-2 w-full mb-2">

    <label class="block text-sm">рд╢реБрд░реБрдЖрддреА рд▓рдВрдмрд╛рдИ (ft)</label>
    <input type="number" id="initialLength" value="50" class="border p-2 w-full mb-2">

    <label class="block text-sm">рд╢реБрд░реБрдЖрддреА рдЪреМрдбрд╝рд╛рдИ (ft)</label>
    <input type="number" id="initialWidth" value="20" class="border p-2 w-full mb-2">

    <h3 class="font-bold mt-3 mb-1">рдЕрддрд┐рд░рд┐рдХреНрдд рдкреНрд▓реЙрдЯ рдХреНрд╖реЗрддреНрд░ (рдкреНрд░рддрд┐-рд╕рд╛рдЗрдб рдорд╛рдиреЗрдВ)</h3>
    <p class="text-sm text-gray-700 mb-2">
      <strong>рдиреЛрдЯ:</strong> рдЬреЛ рдорд╛рди рдЖрдк рдпрд╣рд╛рдБ рдбрд╛рд▓реЗрдВрдЧреЗ рд╡рд╣ <b>рдкреНрд░рддрд┐-рд╕рд╛рдЗрдб (per-side)</b> рдорд╛рдирд╛ рдЬрд╛рдПрдЧрд╛ тАФ рдЕрд░реНрдерд╛рддреН рдЖрдЧреЗ рдФрд░ рдкреАрдЫреЗ / рдмрд╛рдПрдБ рдФрд░ рджрд╛рдпрд╛рдБ рджреЛрдиреЛрдВ рддрд░рдл рдЙрддрдирд╛ рдЬреЛрдбрд╝рд╛ рдЬрд╛рдПрдЧрд╛ред
    </p>

    <div id="dynamic-inputs-container" class="space-y-2 mb-2"></div>

    <div class="flex gap-2">
      <select id="addItemSelect" class="border p-2 flex-grow">
        <option value="рдмрд╛рд▓рдХрдиреА (рдкреНрд░рддрд┐-s)">рдмрд╛рд▓рдХрдиреА (рдкреНрд░рддрд┐-s)</option>
        <option value="рдХреИрдгреНрдЯрд┐рд▓реАрд╡рд░ (рдкреНрд░рддрд┐-s)">рдХреИрдгреНрдЯрд┐рд▓реАрд╡рд░ (рдкреНрд░рддрд┐-s)</option>
        <option value="рд╕реНрд▓реИрдм (рдкреНрд░рддрд┐-s)">рд╕реНрд▓реИрдм (рдкреНрд░рддрд┐-s)</option>
        <option value="рд▓рд┐рдВрдЯрд▓ рдмреАрдо (рдкреНрд░рддрд┐-s)">рд▓рд┐рдВрдЯрд▓ рдмреАрдо (рдкреНрд░рддрд┐-s)</option>
        <option value="рд╕реАрдврд╝реА (рдкреНрд░рддрд┐-s)">рд╕реАрдврд╝реА (рдкреНрд░рддрд┐-s)</option>
        <option value="рдмреАрдо рдлреБрдЯ (рдкреНрд░рддрд┐-s)">рдмреАрдо рдлреБрдЯ (рдкреНрд░рддрд┐-s)</option>
        <option value="рдЕрдиреНрдп (рдкреНрд░рддрд┐-s)">рдЕрдиреНрдп (рдкреНрд░рддрд┐-s)</option>
        <option value="рдкреНрд▓реЙрдЯ 1 (рдкреНрд░рддрд┐-s)">рдкреНрд▓реЙрдЯ 1 (рдкреНрд░рддрд┐-s)</option>
        <option value="рдкреНрд▓реЙрдЯ 2 (рдкреНрд░рддрд┐-s)">рдкреНрд▓реЙрдЯ 2 (рдкреНрд░рддрд┐-s)</option>
      </select>
      <button id="addItemBtn" class="bg-blue-600 text-white px-3 rounded">+</button>
    </div>
  </div>

  <!-- Canvas + Tables -->
  <div class="bg-white p-3 rounded shadow lg:col-span-2">
    <h2 class="font-semibold text-sm mb-2">Plot Diagram</h2>

    <div class="canvas-wrap">
      <!-- responsive canvas: will scale on high-DPI too -->
      <canvas id="plotCanvas" style="width:100%; height:280px; display:block;"></canvas>
      <div class="legend" id="legend"></div>
    </div>

    <div class="mt-3 overflow-x-auto">
      <h3 class="font-bold">Area Calculation Summary</h3>
      <table>
        <thead><tr><th>рдЖрдЗрдЯрдо</th><th>рд▓рдВрдмрд╛рдИ (ft)</th><th>рдЪреМрдбрд╝рд╛рдИ (ft)</th><th>рдХреНрд╖реЗрддреНрд░рдлрд▓ (sq.ft)</th><th>рдЕрдВрддрд░ (sq.ft)</th></tr></thead>
        <tbody id="area-summary-body"></tbody>
      </table>

      <h3 class="font-bold mt-3">Details Summary (Cost)</h3>
      <table>
        <thead><tr><th>рдЖрдЗрдЯрдо</th><th>рдкреВрд░реА рд░рд╛рд╢рд┐</th><th>рдЖрдзреА рд░рд╛рд╢рд┐</th><th>рдкреНрд░рддрд┐ рд╡рд░реНрдЧ рдлреБрдЯ рджрд░</th></tr></thead>
        <tbody id="cost-summary-body"></tbody>
      </table>
    </div>
  </div>

</div>

<!-- Footer Buttons -->
<div class="no-print mt-4 p-3 bg-gray-100 rounded-lg text-center flex justify-center gap-3 flex-wrap">
  <a class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded flex items-center gap-2" href="https://wa.me/919340726600?text=Hello%2C%20I%20need%20assistance%20regarding%20the%20plot%20area%20calculator." target="_blank">
    <img src="https://img.icons8.com/color/48/000000/whatsapp.png" alt="WhatsApp" style="width:18px;height:18px;">
    Need Help? WhatsApp: 9340726600
  </a>
  <a class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded flex items-center gap-2" href="https://startpayonline.com/" target="_blank">
    ЁЯМР Visit StartPayOnline
  </a>
</div>
<div class="no-print text-center text-xs text-gray-500 mt-2">
  <p>ЁЯУй Auto WhatsApp Message | <span style="color:#cc0000;">* Terms & Conditions apply *</span></p>
</div>

<script>
/* ========== Responsive Canvas Setup ========== */
function setupHiDPICanvas(canvas, widthPx, heightPx) {
  // make canvas size responsive to container width while maintaining aspect ratio
  const ratio = window.devicePixelRatio || 1;
  const styleWidth = canvas.clientWidth || widthPx;
  const styleHeight = heightPx;
  canvas.width = Math.round(styleWidth * ratio);
  canvas.height = Math.round(styleHeight * ratio);
  canvas.style.height = styleHeight + 'px';
  const ctx = canvas.getContext('2d');
  ctx.setTransform(ratio,0,0,ratio,0,0);
  return ctx;
}

/* ========== Main App ========== */
document.addEventListener('DOMContentLoaded', () => {
  // format helpers
  const formatRsSingle = v => (isNaN(v) ? 'тВ╣ 0.00' : 'тВ╣ ' + (v||0).toLocaleString('en-IN',{minimumFractionDigits:2, maximumFractionDigits:2}));
  const formatNum = (v, d=2) => (isNaN(v) ? '0.00' : (v||0).toLocaleString('en-IN',{minimumFractionDigits:d, maximumFractionDigits:d}));

  // DOM
  const rateFullEl = document.getElementById('rateFull');
  const lenEl = document.getElementById('initialLength');
  const widEl = document.getElementById('initialWidth');
  const addBtn = document.getElementById('addItemBtn');
  const sel = document.getElementById('addItemSelect');
  const dynContainer = document.getElementById('dynamic-inputs-container');
  const areaBody = document.getElementById('area-summary-body');
  const costBody = document.getElementById('cost-summary-body');
  const legendDiv = document.getElementById('legend');
  const printBtn = document.getElementById('printBtn');

  // canvas
  const canvas = document.getElementById('plotCanvas');
  let ctx = setupHiDPICanvas(canvas, 760, 280);

  // color setup: base dark red and lighter tints for outer layers
  const baseColor = '#CC0000';
  const colors = [
    baseColor,
    '#d24b4b',
    '#e17676',
    '#f2b0b0',
    '#fadede',
    '#fceaea'
  ];

  // add dynamic field
  function addDynamicField() {
    const name = sel.value;
    const def = name.includes('рдмрд╛рд▓рдХрдиреА') ? 4 : (name.includes('рдХреИрдгреНрдЯрд┐рд▓реАрд╡рд░') ? 1 : 0);
    const wrapper = document.createElement('div');
    wrapper.className = 'border p-2 rounded bg-gray-50';
    wrapper.innerHTML = `
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;">
        <strong class="step-name" style="font-size:14px;">${name}</strong>
        <span class="remove-btn" style="font-size:16px;">тЭМ</span>
      </div>
      <label style="font-size:13px;">рдкреНрд░рддрд┐-рд╕рд╛рдЗрдб рд╡реГрджреНрдзрд┐ (ft) рд▓рдВрдмрд╛рдИ</label>
      <input type="number" class="dyn-l border p-1 w-full mb-1" value="${def}">
      <label style="font-size:13px;">рдкреНрд░рддрд┐-рд╕рд╛рдЗрдб рд╡реГрджреНрдзрд┐ (ft) рдЪреМрдбрд╝рд╛рдИ</label>
      <input type="number" class="dyn-w border p-1 w-full" value="${def}">
    `;
    dynContainer.appendChild(wrapper);
    wrapper.querySelectorAll('input').forEach(i => i.addEventListener('input', updateAll));
    wrapper.querySelector('.remove-btn').addEventListener('click', () => { wrapper.remove(); updateAll(); });
    updateAll();
  }

  addBtn.addEventListener('click', addDynamicField);
  printBtn.addEventListener('click', () => window.print());
  [rateFullEl, lenEl, widEl].forEach(el => el.addEventListener('input', updateAll));
  window.addEventListener('resize', () => { ctx = setupHiDPICanvas(canvas, canvas.clientWidth, 280); updateAll(); });

  function updateAll() {
    const rateFull = parseFloat(rateFullEl.value) || 0;
    const rateHalf = rateFull / 2;
    let len = parseFloat(lenEl.value) || 0;
    let wid = parseFloat(widEl.value) || 0;
    const initialArea = len * wid;

    // tables
    let areaHtml = `<tr><td>Initial Plot</td><td>${formatNum(len)}</td><td>${formatNum(wid)}</td><td>${formatNum(initialArea)}</td><td>-</td></tr>`;
    let costHtml = `<tr><td>Initial Plot</td><td>${formatRsSingle(initialArea * rateFull)}</td><td>${formatRsSingle(initialArea * rateFull)}</td><td>тВ╣ ${formatNum(rateFull,0)}</td></tr>`;

    let prevArea = initialArea;
    let totalFull = initialArea * rateFull;
    let totalHalf = initialArea * rateFull;

    const layers = [];
    layers.push({name:'Initial Plot', length: len, width: wid});

    // dynamic fields in order
    const dynDivs = Array.from(dynContainer.children);
    dynDivs.forEach((div) => {
      const stepName = div.querySelector('.step-name').textContent;
      const pl = parseFloat(div.querySelector('.dyn-l').value) || 0;
      const pw = parseFloat(div.querySelector('.dyn-w').value) || 0;
      // per-side -> total add both sides
      const addLen = pl * 2;
      const addWid = pw * 2;
      len += addLen;
      wid += addWid;
      const newArea = len * wid;
      const diff = newArea - prevArea;
      prevArea = newArea;

      areaHtml += `<tr><td>${stepName}</td><td>+${formatNum(addLen)}</td><td>+${formatNum(addWid)}</td><td>-</td><td>${formatNum(diff)}</td></tr>`;
      areaHtml += `<tr class="total-row"><td>Total After ${stepName}</td><td>${formatNum(len)}</td><td>${formatNum(wid)}</td><td>${formatNum(newArea)}</td><td>-</td></tr>`;

      totalFull += diff * rateFull;
      totalHalf += diff * rateHalf;
      costHtml += `<tr><td>${stepName}</td><td>${formatRsSingle(diff * rateFull)}</td><td>${formatRsSingle(diff * rateHalf)}</td><td>тВ╣ ${formatNum(rateFull,0)}</td></tr>`;

      layers.push({name: stepName, length: len, width: wid});
    });

    areaHtml += `<tr class="final-total-row"><td>Final Plot</td><td>${formatNum(len)}</td><td>${formatNum(wid)}</td><td>${formatNum(len*wid)}</td><td>-</td></tr>`;
    costHtml += `<tr class="total-row"><td>GRAND TOTAL</td><td>${formatRsSingle(totalFull)}</td><td>${formatRsSingle(totalHalf)}</td><td>-</td></tr>`;

    areaBody.innerHTML = areaHtml;
    costBody.innerHTML = costHtml;

    // draw
    drawLayersOnCanvas(layers);
  }

  function drawLayersOnCanvas(layers) {
    // ensure HiDPI canvas sized
    ctx = setupHiDPICanvas(canvas, canvas.clientWidth, 280);
    ctx.clearRect(0,0,canvas.width,canvas.height);
    // scale calculation: choose orientation so that longer dimension maps to canvas height (portrait-preference)
    // take outermost layer
    const outer = layers[layers.length - 1];
    const maxLen = Math.max(...layers.map(l => l.length));
    const maxWid = Math.max(...layers.map(l => l.width));
    // padding in pixels
    const pad = 36;
    // compute available px area (in CSS px, since ctx already transformed)
    const availW = canvas.clientWidth - pad*2;
    const availH = (parseInt(canvas.style.height) || 280) - pad*2;

    // We want portrait-feel if length >= width: give priority to height scaling
    // If length >= width -> scaleY = availH / length, scaleX = availW / width; scale = min(scaleX, scaleY)
    // But ensure rectangle visually tends to portrait when length >> width.
    let scaleByHeight = availH / maxLen; // treating length as vertical (so portrait)
    let scaleByWidth = availW / maxLen;  // treating length as horizontal (landscape)
    // We'll consider two mappings: map length->height (portrait) or length->width (landscape).
    // Decide based on which mapping gives better fit while preferring portrait when length >= width.
    let usePortrait = maxLen >= maxWid;
    // compute scale if length->height:
    const scalePortrait = Math.min(availH / maxLen, availW / maxWid);
    // compute scale if length->width (landscape):
    const scaleLandscape = Math.min(availW / maxLen, availH / maxWid);

    const scale = usePortrait ? scalePortrait : scaleLandscape;

    // center
    const centerX = canvas.clientWidth / 2;
    const centerY = (parseInt(canvas.style.height) || 280) / 2;

    // draw outer layers first (below), inner last
    legendDiv.innerHTML = '';
    for (let i = layers.length - 1, li = 0; i >= 0; i--, li++) {
      const layer = layers[i];
      const color = colors[li % colors.length];
      const wPx = layer.length * scale;
      const hPx = layer.width * scale;
      // To make portrait when mapping length->vertical: we will map length to height (hPx = length*scale) and width to width (wPx = width*scale).
      // But above we computed wPx as length*scale and hPx as width*scale тАФ adjust mapping for portrait mode:
      // If usePortrait, treat layer.length => height; layer.width => width
      let drawW = layer.width * scale;
      let drawH = layer.length * scale;
      if (!usePortrait) {
        // standard mapping: length => width, width => height
        drawW = layer.length * scale;
        drawH = layer.width * scale;
      }
      const x = centerX - drawW/2;
      const y = centerY - drawH/2;
      ctx.lineWidth = 3;
      ctx.strokeStyle = color;
      ctx.globalAlpha = 0.95;
      ctx.strokeRect(x, y, drawW, drawH);

      // legend item (outermost first)
      const legItem = document.createElement('div');
      legItem.className = 'legend-item';
      const dot = document.createElement('span');
      dot.className = 'dot';
      dot.style.background = color;
      legItem.appendChild(dot);
      const txt = document.createElement('span');
      txt.textContent = layer.name + ` (${Math.round(layer.length)}├Ч${Math.round(layer.width)} ft)`;
      legItem.appendChild(txt);
      legendDiv.appendChild(legItem);
    }
    ctx.globalAlpha = 1.0;

    // directions: place around the outermost rectangle
    const outerLayer = layers[layers.length - 1];
    let outerW = usePortrait ? outerLayer.width * scale : outerLayer.length * scale;
    let outerH = usePortrait ? outerLayer.length * scale : outerLayer.width * scale;
    const ox = centerX - outerW/2;
    const oy = centerY - outerH/2;
    ctx.fillStyle = '#000000'; // dark black labels
    ctx.font = '14px Arial';

    // North (top / back)
    ctx.textAlign = 'center';
    ctx.fillText('North (рдмреИрдХ рд╕рд╛рдЗрдб)', centerX, oy - 10);
    // South (bottom / front)
    ctx.fillText('South (рдлреНрд░рдВрдЯ рд╕рд╛рдЗрдб)', centerX, oy + outerH + 18);
    // East (left side)
    ctx.textAlign = 'right';
    ctx.fillText('East (рд▓реЗрдлреНрдЯ рд╕рд╛рдЗрдб)', ox - 8, centerY + 4);
    // West (right side)
    ctx.textAlign = 'left';
    ctx.fillText('West (рд░рд╛рдЗрдЯ рд╕рд╛рдЗрдб)', ox + outerW + 8, centerY + 4);
  }

  // initial listeners
  updateAll();
});
</script>

</body>
</html>
